---
title: 内存管理——概念
date: 2021-07-24 17:34:43
toc: true #是否显示文章目录
categories: "内存管理" #分类
tags: #标签
	- linux
	- mem
---

&emsp;&emsp;在早期的计算机中，程序是直接运行在物理内存上的。即程序在运行的过程中访问的都是物理地址。如果这个系统只运行一个程序，那么只要这个程序所需的内存不要超过该机器的物理内存就不会出现问题。

&emsp;&emsp;然而现在的系统都是支持多任务，多进程的，这样CPU以及其他硬件的利用率会更高，这个时候就要考虑到将系统内有限的物理内存如何及时有效的分配给多个程序了，这个事情本身就称之为**内存管理**。

## 1）早期计算机系统中内存分配管理

&emsp;&emsp;假如有三个程序，程序A，B，C，程序A运行的过程中需要10M内存，程序B运行的过程中需要100M内存，而程序C运行的过程中需要20M内存。如果系统同时需要运行程序A和B，那么早期的内存管理过程大概是这样的。

&emsp;&emsp;将物理内存的前10M分配给A，接下来的10M-110M分配给B。这种内存管理的方法比较直接，假设这个时候想让程序C也运行，同时假设系统的内存只有128M，显然按照这种方法程序C由于内存不够是不能够运行的。

&emsp;&emsp;这个时候就需要虚拟内存技术 了，内存空间不够的时候可以将程序不需要用到的数据交换到磁盘空间上去，已达到扩展内存空间的目的。

## 2）内存管理中存在的问题

### （1）进程地址空间不能隔离

&emsp;&emsp;由于程序直接访问的是物理内存，这个时候程序所使用的内存空间不是隔离的。举个例子，就像上面说的A的地址空间是0-10M这个范围内，但是如果A中有一段代码是操作10M-128M这段地址空间内的数据，那么程序B和程序C就很可能会崩溃（每个程序都可以访问系统的整个地址空间）。这样很多恶意程序或者是木马程序可以轻而易举地破快其他的程序，系统的安全性也就得不到保障了，这对用户来说也是不能容忍的。

### （2）内存使用的效率低

&emsp;&emsp;如果要让程序A、B、C同时运行，那么唯一的方法就是使用虚拟内存技术将一些程序暂时不用的数据写到磁盘上，在需要的时候再从磁盘读回内存。

&emsp;&emsp;这里程序C要运行，将A交换到磁盘上去显然是不行的，因为程序是需要连续的地址空间的，程序C需要20M的内存，而A只有10M的空间，所以需要将程序B交换到磁盘上去，而B足足有100M，可以看到为了运行程序C我们需要将100M的数据从内存写到磁盘，然后在程序B需要运行的时候再从磁盘读到内存，而IO操作比较耗时，所以这个过程效率将会十分低下。

### （3）程序运行的地址不能确定

&emsp;&emsp;程序每次需要运行时，都需要在内存中分配一块足够大的空闲区域，而问题是这个空闲的位置是不能确定的，这会带来一些重定位的问题，重定位的问题确定就是程序中引用的变量和函数的地址。

&emsp;&emsp;内存管理为了解决上面三个问题，引入了一个中间层，即程序和物理内存之间的***\*虚拟内存\****。

&emsp;&emsp;程序只能看见虚拟内存，再也不能直接访问物理内存。每个程序都有自己独立的进程地址空间，这样就做到了进程隔离。这里的进程地址空间是指虚拟地址。顾名思义，既然是虚拟地址，也就是虚的，不是现实存在的地址空间。

&emsp;&emsp;既然程序和物理地址空间之间增加了虚拟地址，那么就要解决怎么从虚拟地址映射到物理地址，因为程序最终肯定是运行在物理内存中的，主要有分段和分页两种技术。